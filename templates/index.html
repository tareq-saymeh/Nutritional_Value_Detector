{% extends 'base.html' %}
{% block head %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<style>
  .img-preview {
    max-width: 100%;
    height: auto;
  }
</style>
{% endblock %}

{% block body %}
<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="aperture" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10"></circle>
    <path d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83m13.79-4l-5.74 9.94"></path>
  </symbol>
  <symbol id="cart" viewBox="0 0 16 16">
    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l.84 4.479 9.144-.459L13.89 4H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"></path>
  </symbol>
  <symbol id="chevron-right" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"></path>
  </symbol>
</svg>

<main class="container">
  <div class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-body-secondary">
    <div class="row">
      <div class="col-lg-6 px-0">
        <h1 class="display-4 fst-italic">Food Guide</h1>
      </div>
      <div class="col-lg-6 px-0">
        <form id="imageForm" enctype="multipart/form-data">
          <div class="form-group">
            <label for="imageInput">Upload Image:</label>
            <input type="file" class="form-control-file" id="imageInput" accept="image/*" name="image">
          </div>
          <button type="submit" class="btn btn-primary mt-3">Submit</button>
        </form>
        <div id="imagePreview" class="mt-3">
          <img id="preview" class="img-preview" src="{{ image_url }}" alt="Image Preview" />
        </div>
      </div>
    </div>
  </div>
  
  {% if info %}
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Nutrition Info</th>
          <th>Value</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Name</td>
          <td>{{ info.name }}</td>
        </tr>
        <tr>
          <td>Calories</td>
          <td>{{ info.calories }}</td>
        </tr>
        <tr>
          <td>Carbohydrates (g)</td>
          <td>{{ info.carbohydrates_total_g }}</td>
        </tr>
        <tr>
          <td>Cholesterol (mg)</td>
          <td>{{ info.cholesterol_mg }}</td>
        </tr>
        <tr>
          <td>Fat (g)</td>
          <td>{{ info.fat_total_g }}</td>
        </tr>
        <tr>
          <td>Saturated Fat (g)</td>
          <td>{{ info.fat_saturated_g }}</td>
        </tr>
        <tr>
          <td>Fiber (g)</td>
          <td>{{ info.fiber_g }}</td>
        </tr>
        <tr>
          <td>Potassium (mg)</td>
          <td>{{ info.potassium_mg }}</td>
        </tr>
        <tr>
          <td>Protein (g)</td>
          <td>{{ info.protein_g }}</td>
        </tr>
        <tr>
          <td>Serving Size (g)</td>
          <td>{{ info.serving_size_g }}</td>
        </tr>
        <tr>
          <td>Sodium (mg)</td>
          <td>{{ info.sodium_mg }}</td>
        </tr>
        <tr>
          <td>Sugar (g)</td>
          <td>{{ info.sugar_g }}</td>
        </tr>
      </tbody>
    </table>
  </div>
  {% endif %}
</main>

<script>
  document.getElementById('imageInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('preview').src = e.target.result;
      }
      reader.readAsDataURL(file);
    }
  });

  document.getElementById('imageForm').addEventListener('submit', function(event) {
    event.preventDefault();
    const formData = new FormData(this);

    fetch('/upload', {
      method: 'POST',
      body: formData
    })
    .then(response => response.text())
    .then(data => {
      document.open();
      document.write(data);
      document.close();
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
</script>

{% endblock %}
